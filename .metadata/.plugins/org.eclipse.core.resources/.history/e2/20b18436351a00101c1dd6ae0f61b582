package do_an_1;

import javax.swing.*;
import java.awt.*;
import java.text.DecimalFormat;
import java.util.ArrayList;

public class PanelSanPham extends JPanel {
    private ArrayList<SanPham> dsSanPham = new ArrayList<>();
    private JTable table;

    public PanelSanPham() {
        setLayout(new BorderLayout());

        // Tạo bảng hiển thị sản phẩm
        String[] columns = {"Mã SP", "Tên", "Hãng", "Giá", "Số lượng", "Chip", "Số camera", "Pin", "Màn hình"};
        Object[][] data = {}; // Ban đầu không có dữ liệu
        table = new JTable(data, columns);
        JScrollPane scrollPane = new JScrollPane(table);
        add(scrollPane, BorderLayout.CENTER);

        // Nút thêm, sửa, xóa sản phẩm
        JPanel buttonPanel = new JPanel();
        buttonPanel.setLayout(new FlowLayout(FlowLayout.LEFT));

        JButton btnAdd = new JButton("Thêm sản phẩm");
        btnAdd.addActionListener(e -> addProduct());
        buttonPanel.add(btnAdd);

        JButton btnEdit = new JButton("Sửa sản phẩm");
        btnEdit.addActionListener(e -> editProduct());
        buttonPanel.add(btnEdit);

        JButton btnDelete = new JButton("Xóa sản phẩm");
        btnDelete.addActionListener(e -> deleteProduct());
        buttonPanel.add(btnDelete);

        add(buttonPanel, BorderLayout.SOUTH);
    }

    private void addProduct() {
        JDialog addProductDialog = new JDialog();
        addProductDialog.setTitle("Thêm sản phẩm");
        addProductDialog.setSize(400, 400);
        addProductDialog.setLocationRelativeTo(this);

        JPanel panel = new JPanel();
        panel.setLayout(new GridLayout(10, 2, 5, 5));

        JTextField txtMaSP = new JTextField();
        JTextField txtTen = new JTextField();
        JTextField txtHang = new JTextField();
        JTextField txtGia = new JTextField();
        JTextField txtSoLuong = new JTextField();
        JTextField txtChip = new JTextField();
        JTextField txtSoCamera = new JTextField();
        JTextField txtDungLuongPin = new JTextField();
        JTextField txtKichThuocManHinh = new JTextField();
        JTextField txtHinhMinhHoa = new JTextField();

        panel.add(new JLabel("Mã SP:"));
        panel.add(txtMaSP);
        panel.add(new JLabel("Tên sản phẩm:"));
        panel.add(txtTen);
        panel.add(new JLabel("Hãng:"));
        panel.add(txtHang);
        panel.add(new JLabel("Giá:"));
        panel.add(txtGia);
        panel.add(new JLabel("Số lượng:"));
        panel.add(txtSoLuong);
        panel.add(new JLabel("Chip:"));
        panel.add(txtChip);
        panel.add(new JLabel("Số camera:"));
        panel.add(txtSoCamera);
        panel.add(new JLabel("Dung lượng pin:"));
        panel.add(txtDungLuongPin);
        panel.add(new JLabel("Kích thước màn hình:"));
        panel.add(txtKichThuocManHinh);
        panel.add(new JLabel("Hình minh họa:"));
        panel.add(txtHinhMinhHoa);

        JButton btnAdd = new JButton("Thêm sản phẩm");
        btnAdd.addActionListener(e -> {
            String maSP = txtMaSP.getText();
            String ten = txtTen.getText();
            String hang = txtHang.getText();
            double gia = Double.parseDouble(txtGia.getText());
            int soLuong = Integer.parseInt(txtSoLuong.getText());
            String chip = txtChip.getText();
            int soCamera = Integer.parseInt(txtSoCamera.getText());
            int dungLuongPin = Integer.parseInt(txtDungLuongPin.getText());
            double kichThuocManHinh = Double.parseDouble(txtKichThuocManHinh.getText());
            String hinhMinhHoa = txtHinhMinhHoa.getText();

            SanPham newProduct = new SanPham(maSP, ten, hang, gia, soLuong, chip, soCamera, dungLuongPin, kichThuocManHinh);
            newProduct.setHinhMinhHoa(hinhMinhHoa);
            dsSanPham.add(newProduct);

            updateProductTable();
            addProductDialog.dispose();
        });
        panel.add(new JLabel());
        panel.add(btnAdd);

        addProductDialog.add(panel);
        addProductDialog.setModal(true);
        addProductDialog.setVisible(true);
    }

    private void editProduct() {
        int row = table.getSelectedRow();
        if (row == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sản phẩm cần sửa.");
            return;
        }

        SanPham selectedProduct = dsSanPham.get(row);

        JDialog editProductDialog = new JDialog();
        editProductDialog.setTitle("Sửa sản phẩm");
        editProductDialog.setSize(400, 400);
        editProductDialog.setLocationRelativeTo(this);

        JPanel panel = new JPanel();
        panel.setLayout(new GridLayout(10, 2, 5, 5));

        JTextField txtMaSP = new JTextField(selectedProduct.getMaSP());
        JTextField txtTen = new JTextField(selectedProduct.getTen());
        JTextField txtHang = new JTextField(selectedProduct.getHang());
        JTextField txtGia = new JTextField(String.valueOf(selectedProduct.getGia()));
        JTextField txtSoLuong = new JTextField(String.valueOf(selectedProduct.getSoLuong()));
        JTextField txtChip = new JTextField(selectedProduct.getChip());
        JTextField txtSoCamera = new JTextField(String.valueOf(selectedProduct.getSoCamera()));
        JTextField txtDungLuongPin = new JTextField(String.valueOf(selectedProduct.getDungLuongPin()));
        JTextField txtKichThuocManHinh = new JTextField(String.valueOf(selectedProduct.getKichThuocManHinh()));
        JTextField txtHinhMinhHoa = new JTextField(selectedProduct.getHinhMinhHoa());

        panel.add(new JLabel("Mã SP:"));
        panel.add(txtMaSP);
        panel.add(new JLabel("Tên sản phẩm:"));
        panel.add(txtTen);
        panel.add(new JLabel("Hãng:"));
        panel.add(txtHang);
        panel.add(new JLabel("Giá:"));
        panel.add(txtGia);
        panel.add(new JLabel("Số lượng:"));
        panel.add(txtSoLuong);
        panel.add(new JLabel("Chip:"));
        panel.add(txtChip);
        panel.add(new JLabel("Số camera:"));
        panel.add(txtSoCamera);
        panel.add(new JLabel("Dung lượng pin:"));
        panel.add(txtDungLuongPin);
        panel.add(new JLabel("Kích thước màn hình:"));
        panel.add(txtKichThuocManHinh);
        panel.add(new JLabel("Hình minh họa:"));
        panel.add(txtHinhMinhHoa);

        JButton btnEdit = new JButton("Sửa sản phẩm");
        btnEdit.addActionListener(e -> {
            selectedProduct.setMaSP(txtMaSP.getText());
            selectedProduct.setTen(txtTen.getText());
            selectedProduct.setHang(txtHang.getText());
            selectedProduct.setGia(Double.parseDouble(txtGia.getText()));
            selectedProduct.setSoLuong(Integer.parseInt(txtSoLuong.getText()));
            selectedProduct.setChip(txtChip.getText());
            selectedProduct.setSoCamera(Integer.parseInt(txtSoCamera.getText()));
            selectedProduct.setDungLuongPin(Integer.parseInt(txtDungLuongPin.getText()));
            selectedProduct.setKichThuocManHinh(Double.parseDouble(txtKichThuocManHinh.getText()));
            selectedProduct.setHinhMinhHoa(txtHinhMinhHoa.getText());

            updateProductTable();
            editProductDialog.dispose();
        });
        panel.add(new JLabel());
        panel.add(btnEdit);

        editProductDialog.add(panel);
        editProductDialog.setModal(true);
        editProductDialog.setVisible(true);
    }

    private void deleteProduct() {
        int row = table.getSelectedRow();
        if (row == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sản phẩm cần xóa.");
            return;
        }
        dsSanPham.remove(row);
        updateProductTable();
    }

    private void updateProductTable() {
        String[] columns = {"Mã SP", "Tên", "Hãng", "Giá", "Số lượng", "Chip", "Số camera", "Pin", "Màn hình"};
        DecimalFormat df = new DecimalFormat("#,###");
        Object[][] data = new Object[dsSanPham.size()][columns.length];
        for (int i = 0; i < dsSanPham.size(); i++) {
            SanPham sp = dsSanPham.get(i);
            data[i][0] = sp.getMaSP();
            data[i][1] = sp.getTen();
            data[i][2] = sp.getHang();
            data[i][3] = df.format(sp.getGia());
            data[i][4] = sp.getSoLuong();
            data[i][5] = sp.getChip();
            data[i][6] = sp.getSoCamera();
            data[i][7] = sp.getDungLuongPin();
            data[i][8] = sp.getKichThuocManHinh();
        }

        table.setModel(new DefaultTableModel(data, columns));
    }
}
